<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WinGo 3M Live Prediction</title>
<style>
  body {
    background: #0b0b0b;
    color: #00ffcc;
    font-family: monospace;
    text-align: center;
    padding: 10px;
  }
  h1 {
    color: #ffcc00;
    margin-bottom: 10px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
  }
  th, td {
    border: 1px solid #00ffcc;
    padding: 5px;
    text-align: center;
  }
  th {
    background: #111;
  }
  tr:nth-child(even) {
    background: #141414;
  }
  .pred {
    color: #ff3399;
    font-weight: bold;
  }
  .ok { color: #00ff00; }
  .wrong { color: #ff3300; }
</style>
</head>
<body>
  <h1>WinGo 3M Prediction</h1>
  <div id="prediction" class="pred">Loading...</div>

  <table>
    <thead>
      <tr>
        <th>Round</th>
        <th>Number</th>
        <th>Result</th>
        <th>Prediction</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody id="history"></tbody>
  </table>

<script>
const API_URL = "https://draw.ar-lottery01.com/WinGo/WinGo_3M/GetHistoryIssuePage.json";
let historyData = [];
let lastPrediction = null;

// মূল ফাংশন
async function fetchData() {
  try {
    const res = await fetch(`${API_URL}?ts=${Date.now()}`);
    const data = await res.json();
    const rounds = data.data;

    if (!rounds || !Array.isArray(rounds)) return;

    // নতুন ডেটা শুধু যোগ করা হবে
    rounds.forEach(r => {
      if (!historyData.find(h => h.issue === r.issue)) {
        historyData.unshift({
          issue: r.issue,
          number: Number(r.number),
          result: Number(r.number) >= 5 ? "BIG" : "SMALL"
        });
      }
    });

    // সর্বোচ্চ ২০ টা হিস্ট্রি রাখো
    if (historyData.length > 20) historyData = historyData.slice(0, 20);

    // নতুন হিস্ট্রি টেবিলে দেখাও
    renderTable();

    // প্রেডিকশন আপডেট করো
    makePrediction();

  } catch (err) {
    console.error("Fetch Error:", err);
  }
}

// প্রেডিকশন লজিক
function makePrediction() {
  if (historyData.length < 2) return;

  const [last, prev] = historyData;
  let prediction;

  // Momentum & Reversal Rule
  if (last.result === prev.result) {
    prediction = last.result === "BIG" ? "SMALL" : "BIG"; // Reversal
  } else {
    prediction = last.result; // Momentum
  }

  lastPrediction = prediction;

  document.getElementById("prediction").innerHTML =
    `Next Prediction ➜ <b>${prediction}</b>`;
}

// টেবিল আপডেট
function renderTable() {
  const tbody = document.getElementById("history");
  tbody.innerHTML = "";

  historyData.forEach((h, i) => {
    const predicted = (i > 0 && historyData[i - 1].prediction) || lastPrediction;
    const isCorrect = predicted && predicted === h.result;

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${h.issue}</td>
      <td>${h.number}</td>
      <td>${h.result}</td>
      <td>${i === 0 ? `<b class="pred">${lastPrediction || "-"}</b>` : predicted || "-"}</td>
      <td>${i === 0 ? "LIVE" : (isCorrect ? '<span class="ok">✅</span>' : '<span class="wrong">❌</span>')}</td>
    `;
    tbody.appendChild(tr);
  });
}

// প্রতি 3 মিনিট 2 সেকেন্ড পর রিফ্রেশ হবে
setInterval(fetchData, 182000);
fetchData();
</script>
</body>
</html>
