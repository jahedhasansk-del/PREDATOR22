<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WinGo 3M Prediction (20 History)</title>
<style>
  body {
    background: #0b0b0b;
    color: #00ffcc;
    font-family: monospace;
    padding: 10px;
    text-align: center;
  }
  h1 {
    color: #ffcc00;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
  }
  th, td {
    border: 1px solid #00ffcc;
    padding: 6px;
    text-align: center;
  }
  th {
    background: #111;
  }
  tr:nth-child(even) {
    background: #111;
  }
  .pred {
    color: #ff0066;
    font-weight: bold;
  }
  .ok {
    color: #00ff00;
  }
  .wait {
    color: orange;
  }
</style>
</head>
<body>
  <h1>WinGo 3M Prediction Panel</h1>
  <p id="status" class="wait">WAITING FOR DATA...</p>
  <table>
    <thead>
      <tr>
        <th>Round</th>
        <th>Number</th>
        <th>Result</th>
        <th>Prediction</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody id="history"></tbody>
  </table>

<script>
const API_URL = "https://draw.ar-lottery01.com/WinGo/WinGo_3M/GetHistoryIssuePage.json";
let historyData = [];

async function loadData() {
  try {
    const res = await fetch(`${API_URL}?ts=${Date.now()}`);
    const data = await res.json();
    const result = data.data.slice(0, 20).map(x => ({
      issue: x.issue,
      number: Number(x.number),
      result: Number(x.number) >= 5 ? 'BIG' : 'SMALL'
    }));

    // নতুন ডেটা যুক্ত করো, পুরনো বাদ দিও না
    result.forEach(r => {
      if (!historyData.find(h => h.issue === r.issue)) {
        historyData.unshift(r);
      }
    });

    // সর্বোচ্চ ২০ রাউন্ড পর্যন্ত রাখো
    if (historyData.length > 20) historyData = historyData.slice(0, 20);

    updateTable();
    makePrediction();
  } catch (err) {
    console.error("Error:", err);
  }
}

// Prediction Logic
function makePrediction() {
  const status = document.getElementById('status');
  if (historyData.length < 20) {
    status.textContent = "WAITING FOR DATA...";
    status.className = "wait";
    return;
  }

  const lastTwo = historyData.slice(0, 2);
  let prediction = "WAIT";
  if (lastTwo[0].result === lastTwo[1].result) {
    prediction = lastTwo[0].result === "BIG" ? "SMALL" : "BIG"; // reversal
  } else {
    prediction = lastTwo[0].result; // momentum
  }

  status.textContent = `Next Prediction: ${prediction}`;
  status.className = "pred";
}

// টেবিল আপডেট
function updateTable() {
  const tbody = document.getElementById('history');
  tbody.innerHTML = "";
  historyData.forEach((h, i) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${h.issue}</td>
      <td>${h.number}</td>
      <td>${h.result}</td>
      <td>${i === 0 ? '<b class="pred">NEW</b>' : ''}</td>
      <td>${i === 0 ? 'LIVE' : ''}</td>
    `;
    tbody.appendChild(tr);
  });
}

// প্রতি 3 মিনিটে 2 সেকেন্ড পর ডেটা আপডেট
setInterval(loadData, 182000); // (3 মিনিট + 2 সেকেন্ড)
loadData();
</script>
</body>
</html>
